import{r as i,u as B,b as U,B as re,j as e,c as oe,d as A,g as f,e as L,C as O,D as v,f as ie,t as ce,M as le,s as de,h as P,A as ue,i as pe,k as D,l as he,m as G,N as k,L as xe,n as me,o as ye,F as x,p as Ee,q as Se,v as be,w as ge,x as ve,y as Te,z as je,E as Z,G as K,H as Le,V as fe,I as we,J as Ce,K as Oe,O as Ie,Q as Me,R as Ne,S as Y,U as N,W as Ae,X as _e,Y as Re,Z as ke,_ as Pe,$ as De,a0 as Ge,a1 as q,a2 as Be,a3 as Fe,a4 as $,a5 as X}from"./configuratorPage-IgjaEQ9D.js";const J=i.createContext(void 0),He=({children:s})=>{const{minimapVisibility:a}=B(),[t,S]=i.useState(null),[l,y]=i.useState(a),[n,u]=i.useState(U),[m,p]=i.useState(re),[r,b]=i.useState(U.every(o=>o.enable)),E={map:t,initMap:()=>{S(oe())},isMinimap:l,toggleMinimap:()=>{y(o=>!o)},layers:n,switchLayer:o=>{const d=n.map(h=>h.id===o?{...h,enable:!h.enable}:h);b(d.every(h=>h.enable)),u(d)},removeLayer:o=>{const d=n.filter(h=>h.id!==o);u(d),t&&A(t,o)},changeOpacityLayer:(o,d)=>{const h=n.map(C=>C.id===o?{...C,opacity:d}:C);u(h)},selectAll:r,updateAllLayers:o=>{b(o);const d=n.map(h=>({...h,enable:o}));u(d)},baseLayers:m,updateBaseLayers:o=>{const d=m.map(h=>h.id===o?{...h,enable:!0}:{...h,enable:!1});p(d)}};return e.jsx(J.Provider,{value:E,children:s})},w=()=>{const s=i.useContext(J);if(!s)throw new Error("useMapContext must be used within a MapProvider");return s},Q=i.createContext(void 0),We=({children:s})=>{const[a,t]=i.useState(!1),l={showPrintWindow:a,openPrintWindow:y=>{t(y)}};return e.jsx(Q.Provider,{value:l,children:s})},ee=()=>{const s=i.useContext(Q);if(!s)throw new Error("useToolContext must be used within a ToolProvider");return s},Ve=({id:s})=>{var u,m,p;const{toggleMinimap:a}=w(),{showPrintWindow:t,openPrintWindow:S}=ee(),{map:l}=w(),y=(r,b)=>{switch(r){case he:l&&P(l,G);break;case D:a();break;case pe:S(!t);break;case ue:break;case le:l&&b?de(l,b):l&&(A(l,"measurmentLayer"),P(l,G));break;case ie:ce();break}},n=(r,b)=>{for(const g of b){if(g.id===r)return g.icon;if(g.options){const T=n(r,g.options);if(T)return T}}return null};return(u=f(L,s))!=null&&u.options?e.jsxs(v,{className:"nav-link tool-button",children:[e.jsx(v.Toggle,{className:"card",title:(p=f(L,s))==null?void 0:p.title,children:n(s,L)}),e.jsx(v.Menu,{children:f(L,s).options.map(r=>e.jsxs(v.Item,{onClick:()=>y(s,r.type),children:[n(r.id,L)," ",r.title]},r.id))})]}):e.jsx("button",{className:"nav-link tool-button",title:(m=f(L,s))==null?void 0:m.title,onClick:()=>y(s),children:e.jsx(O,{className:"btn btn-primary",children:n(s,L)})})},ze=()=>{const{tools:s}=B();return e.jsxs(k,{fixed:"top",className:"map-nav",style:{padding:".25rem .5rem"},children:[e.jsx(xe,{to:"/",className:"navbar-brand",title:"Go to home page",children:e.jsx(O,{style:{padding:".3rem"},children:e.jsx("img",{src:me,alt:"Go to home page",style:{width:"1.5rem",height:"1.5rem"}})})}),e.jsx(k.Toggle,{"aria-controls":"basic-navbar-nav"}),e.jsx(k.Collapse,{id:"basic-navbar-nav",children:e.jsx(ye,{className:"me-auto",children:s.map(a=>{if(a.enable)return e.jsx(Ve,{...a},a.id)})})})]})},Ue=()=>{const{layers:s,switchLayer:a,removeLayer:t,changeOpacityLayer:S,selectAll:l,updateAllLayers:y}=w();return e.jsxs(x,{className:"sidebar-layers",children:[e.jsx(x.Check,{id:"selectAll",type:"checkbox",label:"Select all",checked:l,onChange:()=>y(!l)}),s.map((n,u)=>e.jsxs("div",{className:"sidebar-layer",children:[e.jsx(x.Check,{id:n.id,type:"checkbox",label:n.id,checked:n.enable,onChange:()=>a(n.id)}),e.jsxs(v,{className:"sidebar-layer-dropdown",children:[e.jsx(v.Toggle,{className:"card",children:e.jsx(Ee,{})}),e.jsxs(v.Menu,{children:[e.jsxs(v.Item,{onClick:()=>console.log("Details: ",n.id),children:[e.jsx(Se,{})," Details"]}),e.jsxs(v.Item,{onClick:()=>t(n.id),children:[e.jsx(be,{})," Remove"]}),e.jsxs(v.Item,{children:[e.jsx(ge,{}),e.jsx(x.Range,{value:n.opacity,min:0,max:1,step:.1,onChange:m=>S(n.id,parseFloat(m.target.value))})]})]})]})]},u))]})},Ze=()=>{const{baseLayers:s,updateBaseLayers:a}=w();return e.jsx(x,{className:"sidebar-base-layers",children:s.map((t,S)=>e.jsxs(O,{onClick:()=>a(t.id),className:"sidebar-base-layers-row",border:t.enable?"primary":"secondary",children:[e.jsx("img",{src:`images/${t.image}`}),e.jsx(x.Check,{id:t.id,name:"baselayers",type:"radio",label:t.name,checked:t.enable,onChange:()=>{}})]},S))})},Ke=({isOpen:s,toggleSidebar:a})=>e.jsxs(O,{className:`map-sidebar ${s?"open":""}`,children:[e.jsx("button",{className:"card",onClick:a,children:s?e.jsx(ve,{}):e.jsx(Te,{})}),e.jsx("div",{className:"map-sidebar-content",children:e.jsxs(je,{defaultActiveKey:"layers",id:"map-sidebar",className:"mb-3",fill:!0,children:[e.jsx(Z,{eventKey:"layers",title:"Layers",children:e.jsx(Ue,{})}),e.jsx(Z,{eventKey:"baseLayers",title:"Base Layers",children:e.jsx(Ze,{})})]})})]}),Ye="SET_CENTER",qe="SET_WIDTH",$e="SET_HEIGHT",Xe="SET_ORIENTATION",Je="SET_FORMAT",Qe="SET_PAGE_SIZE",es="SET_RESOLUTION",ss="SET_SCALE",se={center:null,width:null,height:null,orientation:null,format:null,pageSize:"a4-landscape",resolution:"200",scale:"100"},ts=(s=se,a)=>{switch(a.type){case Ye:return{...s,center:a.payload};case qe:return{...s,width:a.payload};case $e:return{...s,height:a.payload};case Xe:return{...s,orientation:a.payload};case Je:return{...s,format:a.payload};case Qe:return{...s,pageSize:a.payload};case es:return{...s,resolution:a.payload};case ss:return{...s,scale:a.payload};default:return s}},as=()=>{const{map:s}=w(),{showPrintWindow:a,openPrintWindow:t}=ee(),[S,l]=i.useState(null),[y,n]=i.useReducer(ts,se),{center:u,width:m,height:p,orientation:r,format:b,pageSize:g,resolution:T,scale:j}=y,F=c=>{c.preventDefault(),s&&m&&p&&S&&(_e({map:s,width:m,height:p,overviewExtent:S,scale:j,resolution:T,orientation:r}),t(!a))},H=()=>{const[c,E]=Ge[b];let o,d;r==="portrait"?(o=E,d=c):(o=c,d=E),n({type:"SET_WIDTH",payload:o}),n({type:"SET_HEIGHT",payload:d})};i.useEffect(()=>{if(a){const c=s==null?void 0:s.getView().getCenter();c&&n({type:"SET_CENTER",payload:K(c)})}},[a]),i.useEffect(()=>{n({type:"SET_ORIENTATION",payload:g.split("-")[1]}),n({type:"SET_FORMAT",payload:g.split("-")[0]})},[a,g]),i.useEffect(()=>{a&&b&&r&&H()},[a,b,r]),i.useEffect(()=>{if(s&&u&&g&&m&&p&&j){const[c,E]=u||[0,0],o=m/q/+j,d=p/q/+j,h=[c-o,E-d],C=[c+o,E-d],te=[c+o,E+d],ae=[c-o,E+d],M=Le(ae,te,C,h),W=new fe({features:[new we(M)]}),_=Ce(W,Re),V=new Oe({features:new Ie(W.getFeatures())});A(s,"overviewLayer"),s==null||s.addLayer(_),s==null||s.addInteraction(V),l(M==null?void 0:M.getExtent()),V.on("translateend",ne=>{const R=ne.features.item(0).getGeometry(),z=R==null?void 0:R.getExtent();l(z),n({type:"SET_CENTER",payload:K(Me(z))})}),_.setZIndex(999),_.set("id","overviewLayer")}s&&!a&&A(s,"overviewLayer")},[s,a,u,m,p,j]);const I=c=>c.map(E=>e.jsx("option",{value:E.value,children:E.label},E.value));return e.jsxs(O,{className:`map-print ${a?"open":""}`,children:[e.jsx("button",{className:"card",onClick:()=>{t(!a)},children:e.jsx(Ne,{})}),e.jsx("div",{className:"map-print-content",children:e.jsxs(x,{noValidate:!0,onSubmit:F,children:[e.jsxs(Y,{children:[e.jsxs(x.Group,{as:N,controlId:"pageSizeId",children:[e.jsx(x.Label,{children:"Page size"}),e.jsx(x.Select,{size:"sm",name:"pageSize",value:g,onChange:c=>{n({type:"SET_PAGE_SIZE",payload:c.target.value})},required:!0,children:I(ke)})]}),e.jsxs(x.Group,{as:N,controlId:"resolutionId",children:[e.jsx(x.Label,{children:"Resolution"}),e.jsx(x.Select,{size:"sm",name:"resolution",value:T,onChange:c=>{n({type:"SET_RESOLUTION",payload:c.target.value})},required:!0,children:I(Pe)})]})]}),e.jsx("br",{}),e.jsxs(Y,{children:[e.jsxs(x.Group,{as:N,xs:8,controlId:"scaleId",children:[e.jsx(x.Label,{children:"Scale"}),e.jsx(x.Select,{size:"sm",name:"scale",value:j,onChange:c=>{n({type:"SET_SCALE",payload:c.target.value})},required:!0,children:I(De)})]}),e.jsx(x.Group,{as:N,xs:4,style:{marginTop:"auto"},children:e.jsx(Ae,{size:"sm",type:"submit",variant:"primary",children:"Export PDF"})})]})]})})]})},ns=()=>{const{minimapVisibility:s,tools:a}=B(),{map:t,initMap:S,isMinimap:l,layers:y,baseLayers:n}=w(),[u,m]=i.useState(null);return i.useEffect(()=>{S(),m(Be())},[]),i.useEffect(()=>{var p;(p=f(a,D))!=null&&p.enable&&s?t==null||t.addControl(u):t==null||t.removeControl(u)},[t,s,a]),i.useEffect(()=>{var r;const p=!(t!=null&&t.getControls().getArray().includes(u));(r=f(a,D))!=null&&r.enable&&l&&p?t==null||t.addControl(u):t==null||t.removeControl(u)},[l]),i.useEffect(()=>{if(t){navigator.geolocation.getCurrentPosition(r=>{const{longitude:b,latitude:g}=r.coords,T=Fe([b,g]);t.getView().setCenter(T)},r=>{console.error("Error getting geolocation:",r)},{enableHighAccuracy:!0}),$(t,y),X(t,n);const p=r=>{t&&r.key==="Escape"&&P(t,G)};return window.addEventListener("keydown",p),()=>{window.removeEventListener("keydown",p)}}},[t]),i.useEffect(()=>{t&&$(t,y)},[y]),i.useEffect(()=>{t&&X(t,n)},[n]),e.jsx("main",{className:"map-view",id:"map-view"})},is=()=>{const[s,a]=i.useState(!1),t=()=>{a(!s)};return e.jsx(He,{children:e.jsxs(We,{children:[e.jsx(ze,{}),e.jsx(Ke,{isOpen:s,toggleSidebar:t}),e.jsx(as,{}),e.jsx(ns,{})]})})};export{is as default};
