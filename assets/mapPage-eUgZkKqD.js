import{r as i,u as H,b as Y,B as ie,j as e,c as le,d as R,e as ce,M as O,f as L,g as T,h as w,C as N,D as f,i as de,t as ue,k as pe,s as he,l as B,A as xe,m as me,n as F,o as ye,p as G,N as W,L as je,q as Ee,v as Se,F as E,w as be,x as fe,y as ge,z as ve,E as we,G as Te,H as Le,I as Ce,J as q,K as $,O as Me,V as Oe,Q as Ne,R as Ie,S as Ae,U as _e,W as Re,X as ke,Y as X,Z as _,_ as De,$ as Pe,a0 as We,a1 as Be,a2 as Fe,a3 as Ge,a4 as J,a5 as He,a6 as ze,a7 as Q,a8 as ee}from"./configuratorPage-_WYYJljH.js";const se=i.createContext(void 0),Ve=({children:s})=>{const{minimapVisibility:a}=H(),[t,x]=i.useState(null),[l,y]=i.useState(a),[r,u]=i.useState(Y),[o,c]=i.useState(ie),[n,j]=i.useState(Y.every(d=>d.enable)),b={map:t,initMap:()=>{x(le())},isMinimap:l,toggleMinimap:()=>{y(d=>!d)},layers:r,switchLayer:d=>{const h=r.map(m=>m.id===d?{...m,enable:!m.enable}:m);j(h.every(m=>m.enable)),u(h)},removeLayer:d=>{const h=r.filter(m=>m.id!==d);u(h),t&&R(t,d)},changeOpacityLayer:(d,h)=>{const m=r.map(M=>M.id===d?{...M,opacity:h}:M);u(m)},selectAll:n,updateAllLayers:d=>{j(d);const h=r.map(m=>({...m,enable:d}));u(h)},baseLayers:o,updateBaseLayers:d=>{const h=o.map(m=>m.id===d?{...m,enable:!0}:{...m,enable:!1});c(h)}};return e.jsx(se.Provider,{value:b,children:s})},C=()=>{const s=i.useContext(se);if(!s)throw new Error("useMapContext must be used within a MapProvider");return s},Ue=()=>{var y,r;const{showMoreDetailsWindow:s,moreDetailsWindowContent:a,closeMoreDetailsWindow:t}=k();let x=[],l;return(y=a.features[0])!=null&&y.properties&&(x=Object.keys((r=a.features[0])==null?void 0:r.properties)),a.features.length>0&&x.length>0?l=e.jsxs(ce,{responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),x.map((u,o)=>e.jsx("th",{children:u.toUpperCase()},o))]})}),e.jsx("tbody",{children:a.features.map((u,o)=>e.jsxs("tr",{children:[e.jsx("td",{children:o+1}),Object.values(u.properties).map((c,n)=>e.jsx("td",{children:c},n))]},o))})]}):l=e.jsx(e.Fragment,{children:"No features found"}),e.jsxs(O,{centered:!0,size:"lg",show:s,onHide:t,dialogClassName:"more-details-window",children:[e.jsx(O.Header,{closeButton:!0,children:e.jsx(O.Title,{children:a.title})}),e.jsx(O.Body,{children:l}),e.jsx(O.Footer,{children:e.jsx(L,{variant:"secondary",onClick:t,children:"Close"})})]})},te=i.createContext(void 0),Ze=({children:s})=>{const[a,t]=i.useState(!1),[x,l]=i.useState(!1),[y,r]=i.useState({title:"",features:[]}),n={showPrintWindow:a,openPrintWindow:j=>{t(j)},showMoreDetailsWindow:x,openMoreDetailsWindow:(j,S)=>{r({title:j,features:S}),l(!0)},closeMoreDetailsWindow:()=>{l(!1)},moreDetailsWindowContent:y};return e.jsxs(te.Provider,{value:n,children:[s,e.jsx(Ue,{})]})},k=()=>{const s=i.useContext(te);if(!s)throw new Error("useToolContext must be used within a ToolProvider");return s},Ke=({id:s})=>{var u,o,c;const{toggleMinimap:a}=C(),{showPrintWindow:t,openPrintWindow:x}=k(),{map:l}=C(),y=(n,j)=>{switch(n){case ye:l&&B(l,G);break;case F:a();break;case me:x(!t);break;case xe:break;case pe:l&&j?he(l,j):l&&(R(l,"measurmentLayer"),B(l,G));break;case de:ue();break}},r=(n,j)=>{for(const S of j){if(S.id===n)return S.icon;if(S.options){const g=r(n,S.options);if(g)return g}}return null};return(u=T(w,s))!=null&&u.options?e.jsxs(f,{className:"nav-link tool-button",children:[e.jsx(f.Toggle,{className:"card",title:(c=T(w,s))==null?void 0:c.title,children:r(s,w)}),e.jsx(f.Menu,{children:T(w,s).options.map(n=>e.jsxs(f.Item,{as:L,onClick:()=>y(s,n.type),children:[r(n.id,w)," ",n.title]},n.id))})]}):e.jsx("button",{className:"nav-link tool-button",title:(o=T(w,s))==null?void 0:o.title,onClick:()=>y(s),children:e.jsx(N,{className:"btn btn-primary",children:r(s,w)})})},Ye=()=>{const{tools:s}=H();return e.jsxs(W,{fixed:"top",className:"map-nav",style:{padding:".25rem .5rem"},children:[e.jsx(je,{to:"/",className:"navbar-brand",title:"Go to home page",children:e.jsx(N,{style:{padding:".3rem"},children:e.jsx("img",{src:Ee,alt:"Go to home page",style:{width:"1.5rem",height:"1.5rem"}})})}),e.jsx(W.Toggle,{"aria-controls":"basic-navbar-nav"}),e.jsx(W.Collapse,{id:"basic-navbar-nav",children:e.jsx(Se,{className:"me-auto",children:s.map(a=>{if(a.enable)return e.jsx(Ke,{...a},a.id)})})})]})},qe=()=>{const{layers:s,switchLayer:a,removeLayer:t,changeOpacityLayer:x,selectAll:l,updateAllLayers:y}=C(),{openMoreDetailsWindow:r}=k(),u=async(o,c)=>{const n=await we(c);r(o,n)};return e.jsxs(E,{className:"sidebar-layers",children:[e.jsx(E.Check,{id:"selectAll",type:"checkbox",label:"Select all",checked:l,onChange:()=>y(!l)}),s.map((o,c)=>e.jsxs("div",{className:"sidebar-layer",children:[e.jsx(E.Check,{id:o.id,type:"checkbox",label:o.name,checked:o.enable,onChange:()=>a(o.id)}),e.jsxs(f,{className:"sidebar-layer-dropdown",children:[e.jsx(f.Toggle,{className:"card",children:e.jsx(be,{})}),e.jsxs(f.Menu,{children:[e.jsxs(f.Item,{as:L,onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{children:[e.jsx(fe,{}),"Opacity: "," "+o.opacity]}),e.jsx(E.Range,{value:o.opacity,min:0,max:1,step:.1,onChange:n=>x(o.id,parseFloat(n.target.value))})]}),e.jsxs(f.Item,{as:L,onClick:()=>{o.url&&u(o.name,o.url)},children:[e.jsx(ge,{})," Details"]}),e.jsxs(f.Item,{as:L,onClick:()=>t(o.id),children:[e.jsx(ve,{})," Remove"]})]})]})]},c))]})},$e=()=>{const{baseLayers:s,updateBaseLayers:a}=C();return e.jsx(E,{className:"sidebar-base-layers",children:s.map((t,x)=>e.jsxs(N,{onClick:()=>a(t.id),className:"sidebar-base-layers-row",border:t.enable?"primary":"secondary",children:[e.jsx("img",{src:`images/${t.image}`}),e.jsx(E.Check,{id:t.id,name:"baselayers",type:"radio",label:t.name,checked:t.enable,onChange:()=>{}})]},x))})},Xe=({isOpen:s,toggleSidebar:a})=>e.jsxs(N,{className:`map-sidebar ${s?"open":""}`,children:[e.jsx("button",{className:"card",onClick:a,children:s?e.jsx(Te,{}):e.jsx(Le,{})}),e.jsx("div",{className:"map-sidebar-content",children:e.jsxs(Ce,{defaultActiveKey:"layers",id:"map-sidebar",className:"mb-3",fill:!0,children:[e.jsx(q,{eventKey:"layers",title:"Layers",children:e.jsx(qe,{})}),e.jsx(q,{eventKey:"baseLayers",title:"Base Layers",children:e.jsx($e,{})})]})})]}),Je="SET_CENTER",Qe="SET_WIDTH",es="SET_HEIGHT",ss="SET_ORIENTATION",ts="SET_FORMAT",as="SET_PAGE_SIZE",ns="SET_RESOLUTION",os="SET_SCALE",ae={center:null,width:null,height:null,orientation:null,format:null,pageSize:"a4-landscape",resolution:"200",scale:"100"},rs=(s=ae,a)=>{switch(a.type){case Je:return{...s,center:a.payload};case Qe:return{...s,width:a.payload};case es:return{...s,height:a.payload};case ss:return{...s,orientation:a.payload};case ts:return{...s,format:a.payload};case as:return{...s,pageSize:a.payload};case ns:return{...s,resolution:a.payload};case os:return{...s,scale:a.payload};default:return s}},is=()=>{const{map:s}=C(),{showPrintWindow:a,openPrintWindow:t}=k(),[x,l]=i.useState(null),[y,r]=i.useReducer(rs,ae),{center:u,width:o,height:c,orientation:n,format:j,pageSize:S,resolution:g,scale:v}=y,z=p=>{p.preventDefault(),s&&o&&c&&x&&(De({map:s,width:o,height:c,overviewExtent:x,scale:v,resolution:g,orientation:n}),t(!a))},V=()=>{const[p,b]=Ge[j];let d,h;n==="portrait"?(d=b,h=p):(d=p,h=b),r({type:"SET_WIDTH",payload:d}),r({type:"SET_HEIGHT",payload:h})};i.useEffect(()=>{if(a){const p=s==null?void 0:s.getView().getCenter();p&&r({type:"SET_CENTER",payload:$(p)})}},[a]),i.useEffect(()=>{r({type:"SET_ORIENTATION",payload:S.split("-")[1]}),r({type:"SET_FORMAT",payload:S.split("-")[0]})},[a,S]),i.useEffect(()=>{a&&j&&n&&V()},[a,j,n]),i.useEffect(()=>{if(s&&u&&S&&o&&c&&v){const[p,b]=u||[0,0],d=o/J/+v,h=c/J/+v,m=[p-d,b-h],M=[p+d,b-h],ne=[p+d,b+h],oe=[p-d,b+h],A=Me(oe,ne,M,m),U=new Oe({features:[new Ne(A)]}),D=Ie(U,Pe),Z=new Ae({features:new _e(U.getFeatures())});R(s,"overviewLayer"),s==null||s.addLayer(D),s==null||s.addInteraction(Z),l(A==null?void 0:A.getExtent()),Z.on("translateend",re=>{const P=re.features.item(0).getGeometry(),K=P==null?void 0:P.getExtent();l(K),r({type:"SET_CENTER",payload:$(Re(K))})}),D.setZIndex(999),D.set("id","overviewLayer")}s&&!a&&R(s,"overviewLayer")},[s,a,u,o,c,v]);const I=p=>p.map(b=>e.jsx("option",{value:b.value,children:b.label},b.value));return e.jsxs(N,{className:`map-print ${a?"open":""}`,children:[e.jsx("button",{className:"card",onClick:()=>{t(!a)},children:e.jsx(ke,{})}),e.jsx("div",{className:"map-print-content",children:e.jsxs(E,{noValidate:!0,onSubmit:z,children:[e.jsxs(X,{children:[e.jsxs(E.Group,{as:_,controlId:"pageSizeId",children:[e.jsx(E.Label,{children:"Page size"}),e.jsx(E.Select,{size:"sm",name:"pageSize",value:S,onChange:p=>{r({type:"SET_PAGE_SIZE",payload:p.target.value})},required:!0,children:I(We)})]}),e.jsxs(E.Group,{as:_,controlId:"resolutionId",children:[e.jsx(E.Label,{children:"Resolution"}),e.jsx(E.Select,{size:"sm",name:"resolution",value:g,onChange:p=>{r({type:"SET_RESOLUTION",payload:p.target.value})},required:!0,children:I(Be)})]})]}),e.jsx("br",{}),e.jsxs(X,{children:[e.jsxs(E.Group,{as:_,xs:8,controlId:"scaleId",children:[e.jsx(E.Label,{children:"Scale"}),e.jsx(E.Select,{size:"sm",name:"scale",value:v,onChange:p=>{r({type:"SET_SCALE",payload:p.target.value})},required:!0,children:I(Fe)})]}),e.jsx(E.Group,{as:_,xs:4,style:{marginTop:"auto"},children:e.jsx(L,{size:"sm",type:"submit",variant:"primary",children:"Export PDF"})})]})]})})]})},ls=()=>{const{minimapVisibility:s,tools:a}=H(),{map:t,initMap:x,isMinimap:l,layers:y,baseLayers:r}=C(),[u,o]=i.useState(null);return i.useEffect(()=>{x(),o(He())},[]),i.useEffect(()=>{var c;(c=T(a,F))!=null&&c.enable&&s?t==null||t.addControl(u):t==null||t.removeControl(u)},[t,s,a]),i.useEffect(()=>{var n;const c=!(t!=null&&t.getControls().getArray().includes(u));(n=T(a,F))!=null&&n.enable&&l&&c?t==null||t.addControl(u):t==null||t.removeControl(u)},[l]),i.useEffect(()=>{if(t){navigator.geolocation.getCurrentPosition(n=>{const{longitude:j,latitude:S}=n.coords,g=ze([j,S]);t.getView().setCenter(g)},n=>{console.error("Error getting geolocation:",n)},{enableHighAccuracy:!0}),Q(t,y),ee(t,r);const c=n=>{t&&n.key==="Escape"&&B(t,G)};return window.addEventListener("keydown",c),()=>{window.removeEventListener("keydown",c)}}},[t]),i.useEffect(()=>{t&&Q(t,y)},[y]),i.useEffect(()=>{t&&ee(t,r)},[r]),e.jsx("main",{className:"map-view",id:"map-view"})},us=()=>{const[s,a]=i.useState(!1),t=()=>{a(!s)};return e.jsx(Ve,{children:e.jsxs(Ze,{children:[e.jsx(Ye,{}),e.jsx(Xe,{isOpen:s,toggleSidebar:t}),e.jsx(is,{}),e.jsx(ls,{})]})})};export{us as default};
