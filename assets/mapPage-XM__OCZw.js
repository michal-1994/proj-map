import{r as l,u as H,b as Y,B as ie,j as e,c as le,d as R,M as O,e as ce,f as L,g as f,h as w,C as I,D as g,i as de,t as ue,k as pe,s as he,l as B,A as xe,m as me,n as G,o as ye,p as F,N as W,L as je,q as Ee,v as Se,F as y,w as be,x as ge,y as Te,z as ve,E as we,G as fe,H as Le,I as q,J as $,K as Ce,V as Me,O as Oe,Q as Ie,R as Ne,S as Ae,U as _e,W as Re,X,Y as _,Z as ke,_ as De,$ as Pe,a0 as We,a1 as Be,a2 as Ge,a3 as J,a4 as Fe,a5 as He,a6 as Q,a7 as ee}from"./configuratorPage-8AQLfqey.js";const se=l.createContext(void 0),ze=({children:s})=>{const{minimapVisibility:a}=H(),[t,j]=l.useState(null),[r,E]=l.useState(a),[o,p]=l.useState(Y),[i,u]=l.useState(ie),[n,m]=l.useState(Y.every(c=>c.enable)),b={map:t,initMap:()=>{j(le())},isMinimap:r,toggleMinimap:()=>{E(c=>!c)},layers:o,switchLayer:c=>{const h=o.map(x=>x.id===c?{...x,enable:!x.enable}:x);m(h.every(x=>x.enable)),p(h)},removeLayer:c=>{const h=o.filter(x=>x.id!==c);p(h),t&&R(t,c)},changeOpacityLayer:(c,h)=>{const x=o.map(M=>M.id===c?{...M,opacity:h}:M);p(x)},selectAll:n,updateAllLayers:c=>{m(c);const h=o.map(x=>({...x,enable:c}));p(h)},baseLayers:i,updateBaseLayers:c=>{const h=i.map(x=>x.id===c?{...x,enable:!0}:{...x,enable:!1});u(h)}};return e.jsx(se.Provider,{value:b,children:s})},C=()=>{const s=l.useContext(se);if(!s)throw new Error("useMapContext must be used within a MapProvider");return s},Ve=()=>{const{showMoreDetailsWindow:s,moreDetailsWindowContent:a,closeMoreDetailsWindow:t}=k();return e.jsxs(O,{centered:!0,size:"lg",show:s,onHide:t,dialogClassName:"more-details-window",children:[e.jsx(O.Header,{closeButton:!0,children:e.jsx(O.Title,{children:a.title})}),e.jsx(O.Body,{children:e.jsxs(ce,{responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),Array.from({length:24}).map((j,r)=>e.jsx("th",{children:"Table heading"},r))]})}),e.jsx("tbody",{children:Array.from({length:24}).map((j,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:r+1}),Array.from({length:24}).map((E,o)=>e.jsxs("td",{children:["Table cell ",o]},o))]},r))})]})}),e.jsx(O.Footer,{children:e.jsx(L,{variant:"secondary",onClick:t,children:"Close"})})]})},te=l.createContext(void 0),Ue=({children:s})=>{const[a,t]=l.useState(!1),[j,r]=l.useState(!1),[E,o]=l.useState({title:"",content:""}),n={showPrintWindow:a,openPrintWindow:m=>{t(m)},showMoreDetailsWindow:j,openMoreDetailsWindow:(m,S)=>{o({title:m,content:S}),r(!0)},closeMoreDetailsWindow:()=>{r(!1)},moreDetailsWindowContent:E};return e.jsxs(te.Provider,{value:n,children:[s,e.jsx(Ve,{})]})},k=()=>{const s=l.useContext(te);if(!s)throw new Error("useToolContext must be used within a ToolProvider");return s},Ze=({id:s})=>{var p,i,u;const{toggleMinimap:a}=C(),{showPrintWindow:t,openPrintWindow:j}=k(),{map:r}=C(),E=(n,m)=>{switch(n){case ye:r&&B(r,F);break;case G:a();break;case me:j(!t);break;case xe:break;case pe:r&&m?he(r,m):r&&(R(r,"measurmentLayer"),B(r,F));break;case de:ue();break}},o=(n,m)=>{for(const S of m){if(S.id===n)return S.icon;if(S.options){const T=o(n,S.options);if(T)return T}}return null};return(p=f(w,s))!=null&&p.options?e.jsxs(g,{className:"nav-link tool-button",children:[e.jsx(g.Toggle,{className:"card",title:(u=f(w,s))==null?void 0:u.title,children:o(s,w)}),e.jsx(g.Menu,{children:f(w,s).options.map(n=>e.jsxs(g.Item,{as:L,onClick:()=>E(s,n.type),children:[o(n.id,w)," ",n.title]},n.id))})]}):e.jsx("button",{className:"nav-link tool-button",title:(i=f(w,s))==null?void 0:i.title,onClick:()=>E(s),children:e.jsx(I,{className:"btn btn-primary",children:o(s,w)})})},Ke=()=>{const{tools:s}=H();return e.jsxs(W,{fixed:"top",className:"map-nav",style:{padding:".25rem .5rem"},children:[e.jsx(je,{to:"/",className:"navbar-brand",title:"Go to home page",children:e.jsx(I,{style:{padding:".3rem"},children:e.jsx("img",{src:Ee,alt:"Go to home page",style:{width:"1.5rem",height:"1.5rem"}})})}),e.jsx(W.Toggle,{"aria-controls":"basic-navbar-nav"}),e.jsx(W.Collapse,{id:"basic-navbar-nav",children:e.jsx(Se,{className:"me-auto",children:s.map(a=>{if(a.enable)return e.jsx(Ze,{...a},a.id)})})})]})},Ye=()=>{const{layers:s,switchLayer:a,removeLayer:t,changeOpacityLayer:j,selectAll:r,updateAllLayers:E}=C(),{openMoreDetailsWindow:o}=k(),p=i=>{o("Information about "+i,"Content")};return e.jsxs(y,{className:"sidebar-layers",children:[e.jsx(y.Check,{id:"selectAll",type:"checkbox",label:"Select all",checked:r,onChange:()=>E(!r)}),s.map((i,u)=>e.jsxs("div",{className:"sidebar-layer",children:[e.jsx(y.Check,{id:i.id,type:"checkbox",label:i.id,checked:i.enable,onChange:()=>a(i.id)}),e.jsxs(g,{className:"sidebar-layer-dropdown",children:[e.jsx(g.Toggle,{className:"card",children:e.jsx(be,{})}),e.jsxs(g.Menu,{children:[e.jsxs(g.Item,{as:L,onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{children:[e.jsx(ge,{}),"Opacity: "," "+i.opacity]}),e.jsx(y.Range,{value:i.opacity,min:0,max:1,step:.1,onChange:n=>j(i.id,parseFloat(n.target.value))})]}),e.jsxs(g.Item,{as:L,onClick:()=>p(i.id),children:[e.jsx(Te,{})," Details"]}),e.jsxs(g.Item,{as:L,onClick:()=>t(i.id),children:[e.jsx(ve,{})," Remove"]})]})]})]},u))]})},qe=()=>{const{baseLayers:s,updateBaseLayers:a}=C();return e.jsx(y,{className:"sidebar-base-layers",children:s.map((t,j)=>e.jsxs(I,{onClick:()=>a(t.id),className:"sidebar-base-layers-row",border:t.enable?"primary":"secondary",children:[e.jsx("img",{src:`images/${t.image}`}),e.jsx(y.Check,{id:t.id,name:"baselayers",type:"radio",label:t.name,checked:t.enable,onChange:()=>{}})]},j))})},$e=({isOpen:s,toggleSidebar:a})=>e.jsxs(I,{className:`map-sidebar ${s?"open":""}`,children:[e.jsx("button",{className:"card",onClick:a,children:s?e.jsx(we,{}):e.jsx(fe,{})}),e.jsx("div",{className:"map-sidebar-content",children:e.jsxs(Le,{defaultActiveKey:"layers",id:"map-sidebar",className:"mb-3",fill:!0,children:[e.jsx(q,{eventKey:"layers",title:"Layers",children:e.jsx(Ye,{})}),e.jsx(q,{eventKey:"baseLayers",title:"Base Layers",children:e.jsx(qe,{})})]})})]}),Xe="SET_CENTER",Je="SET_WIDTH",Qe="SET_HEIGHT",es="SET_ORIENTATION",ss="SET_FORMAT",ts="SET_PAGE_SIZE",as="SET_RESOLUTION",ns="SET_SCALE",ae={center:null,width:null,height:null,orientation:null,format:null,pageSize:"a4-landscape",resolution:"200",scale:"100"},os=(s=ae,a)=>{switch(a.type){case Xe:return{...s,center:a.payload};case Je:return{...s,width:a.payload};case Qe:return{...s,height:a.payload};case es:return{...s,orientation:a.payload};case ss:return{...s,format:a.payload};case ts:return{...s,pageSize:a.payload};case as:return{...s,resolution:a.payload};case ns:return{...s,scale:a.payload};default:return s}},rs=()=>{const{map:s}=C(),{showPrintWindow:a,openPrintWindow:t}=k(),[j,r]=l.useState(null),[E,o]=l.useReducer(os,ae),{center:p,width:i,height:u,orientation:n,format:m,pageSize:S,resolution:T,scale:v}=E,z=d=>{d.preventDefault(),s&&i&&u&&j&&(ke({map:s,width:i,height:u,overviewExtent:j,scale:v,resolution:T,orientation:n}),t(!a))},V=()=>{const[d,b]=Ge[m];let c,h;n==="portrait"?(c=b,h=d):(c=d,h=b),o({type:"SET_WIDTH",payload:c}),o({type:"SET_HEIGHT",payload:h})};l.useEffect(()=>{if(a){const d=s==null?void 0:s.getView().getCenter();d&&o({type:"SET_CENTER",payload:$(d)})}},[a]),l.useEffect(()=>{o({type:"SET_ORIENTATION",payload:S.split("-")[1]}),o({type:"SET_FORMAT",payload:S.split("-")[0]})},[a,S]),l.useEffect(()=>{a&&m&&n&&V()},[a,m,n]),l.useEffect(()=>{if(s&&p&&S&&i&&u&&v){const[d,b]=p||[0,0],c=i/J/+v,h=u/J/+v,x=[d-c,b-h],M=[d+c,b-h],ne=[d+c,b+h],oe=[d-c,b+h],A=Ce(oe,ne,M,x),U=new Me({features:[new Oe(A)]}),D=Ie(U,De),Z=new Ne({features:new Ae(U.getFeatures())});R(s,"overviewLayer"),s==null||s.addLayer(D),s==null||s.addInteraction(Z),r(A==null?void 0:A.getExtent()),Z.on("translateend",re=>{const P=re.features.item(0).getGeometry(),K=P==null?void 0:P.getExtent();r(K),o({type:"SET_CENTER",payload:$(_e(K))})}),D.setZIndex(999),D.set("id","overviewLayer")}s&&!a&&R(s,"overviewLayer")},[s,a,p,i,u,v]);const N=d=>d.map(b=>e.jsx("option",{value:b.value,children:b.label},b.value));return e.jsxs(I,{className:`map-print ${a?"open":""}`,children:[e.jsx("button",{className:"card",onClick:()=>{t(!a)},children:e.jsx(Re,{})}),e.jsx("div",{className:"map-print-content",children:e.jsxs(y,{noValidate:!0,onSubmit:z,children:[e.jsxs(X,{children:[e.jsxs(y.Group,{as:_,controlId:"pageSizeId",children:[e.jsx(y.Label,{children:"Page size"}),e.jsx(y.Select,{size:"sm",name:"pageSize",value:S,onChange:d=>{o({type:"SET_PAGE_SIZE",payload:d.target.value})},required:!0,children:N(Pe)})]}),e.jsxs(y.Group,{as:_,controlId:"resolutionId",children:[e.jsx(y.Label,{children:"Resolution"}),e.jsx(y.Select,{size:"sm",name:"resolution",value:T,onChange:d=>{o({type:"SET_RESOLUTION",payload:d.target.value})},required:!0,children:N(We)})]})]}),e.jsx("br",{}),e.jsxs(X,{children:[e.jsxs(y.Group,{as:_,xs:8,controlId:"scaleId",children:[e.jsx(y.Label,{children:"Scale"}),e.jsx(y.Select,{size:"sm",name:"scale",value:v,onChange:d=>{o({type:"SET_SCALE",payload:d.target.value})},required:!0,children:N(Be)})]}),e.jsx(y.Group,{as:_,xs:4,style:{marginTop:"auto"},children:e.jsx(L,{size:"sm",type:"submit",variant:"primary",children:"Export PDF"})})]})]})})]})},is=()=>{const{minimapVisibility:s,tools:a}=H(),{map:t,initMap:j,isMinimap:r,layers:E,baseLayers:o}=C(),[p,i]=l.useState(null);return l.useEffect(()=>{j(),i(Fe())},[]),l.useEffect(()=>{var u;(u=f(a,G))!=null&&u.enable&&s?t==null||t.addControl(p):t==null||t.removeControl(p)},[t,s,a]),l.useEffect(()=>{var n;const u=!(t!=null&&t.getControls().getArray().includes(p));(n=f(a,G))!=null&&n.enable&&r&&u?t==null||t.addControl(p):t==null||t.removeControl(p)},[r]),l.useEffect(()=>{if(t){navigator.geolocation.getCurrentPosition(n=>{const{longitude:m,latitude:S}=n.coords,T=He([m,S]);t.getView().setCenter(T)},n=>{console.error("Error getting geolocation:",n)},{enableHighAccuracy:!0}),Q(t,E),ee(t,o);const u=n=>{t&&n.key==="Escape"&&B(t,F)};return window.addEventListener("keydown",u),()=>{window.removeEventListener("keydown",u)}}},[t]),l.useEffect(()=>{t&&Q(t,E)},[E]),l.useEffect(()=>{t&&ee(t,o)},[o]),e.jsx("main",{className:"map-view",id:"map-view"})},ds=()=>{const[s,a]=l.useState(!1),t=()=>{a(!s)};return e.jsx(ze,{children:e.jsxs(Ue,{children:[e.jsx(Ke,{}),e.jsx($e,{isOpen:s,toggleSidebar:t}),e.jsx(rs,{}),e.jsx(is,{})]})})};export{ds as default};
