import{r as i,u as q,b as Y,B as ie,j as e,c as ce,d as P,e as le,M as C,f as N,F as x,R as G,i as de,g as _,h as A,C as k,D as T,k as ue,t as he,l as pe,s as xe,m as U,A as ye,n as me,o as V,p as je,q as z,N as H,L as Se,v as fe,w as we,x as ge,y as ve,z as be,E as Ee,G as Le,H as Te,I as Ce,J as Ne,K as Me,O as Oe,Q as $,S as Q,U as Ae,V as Ie,W as _e,X as ke,Y as Re,Z as De,_ as We,$ as Pe,a0 as W,a1 as Ge,a2 as Be,a3 as Fe,a4 as He,a5 as Ue,a6 as Ve,a7 as ee,a8 as ze,a9 as qe,aa as se,ab as te,ac as Je}from"./configuratorPage-xtz1ootT.js";const ae=i.createContext(void 0),Ke=({children:s})=>{const{minimapVisibility:a}=q(),[t,h]=i.useState(null),[m,l]=i.useState(a),[n,o]=i.useState(Y),[c,r]=i.useState(ie),[d,u]=i.useState(Y.every(j=>j.enable)),E={map:t,initMap:()=>{h(ce())},isMinimap:m,toggleMinimap:()=>{l(j=>!j)},layers:n,switchLayer:j=>{const g=n.map(p=>p.id===j?{...p,enable:!p.enable}:p);u(g.every(p=>p.enable)),o(g)},removeLayer:j=>{const g=n.filter(p=>p.id!==j);o(g),t&&P(t,j)},addLayer:j=>{const g=[j,...n];o(g)},moveLayer:(j,g)=>{const p=n.findIndex(v=>v.id===j);if(p!==-1){const v=p+g;if(v>=0&&v<n.length){[n[p],n[v]]=[n[v],n[p]];const M=[...n];[M[p],M[v]]=[n[p],n[v]],o(M)}}},changeOpacityLayer:(j,g)=>{const p=n.map(v=>v.id===j?{...v,opacity:g}:v);o(p)},selectAll:d,updateAllLayers:j=>{u(j);const g=n.map(p=>({...p,enable:j}));o(g)},baseLayers:c,updateBaseLayers:j=>{const g=c.map(p=>p.id===j?{...p,enable:!0}:{...p,enable:!1});r(g)}};return e.jsx(ae.Provider,{value:E,children:s})},I=()=>{const s=i.useContext(ae);if(!s)throw new Error("useMapContext must be used within a MapProvider");return s},Xe=()=>{var l,n;const{showMoreDetailsWindow:s,moreDetailsWindowContent:a,closeMoreDetailsWindow:t}=R();let h=[],m;return(l=a.features[0])!=null&&l.properties&&(h=Object.keys((n=a.features[0])==null?void 0:n.properties)),a.features.length>0&&h.length>0?m=e.jsxs(le,{responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No."}),h.map((o,c)=>e.jsx("th",{children:o.toUpperCase()},c))]})}),e.jsx("tbody",{children:a.features.map((o,c)=>e.jsxs("tr",{children:[e.jsx("td",{children:c+1}),Object.values(o.properties).map((r,d)=>e.jsx("td",{children:r},d))]},c))})]}):m=e.jsx(e.Fragment,{children:"No features found"}),e.jsxs(C,{centered:!0,size:"lg",show:s,onHide:t,dialogClassName:"more-details",children:[e.jsx(C.Header,{closeButton:!0,children:e.jsx(C.Title,{children:a.title})}),e.jsx(C.Body,{children:m}),e.jsx(C.Footer,{children:e.jsx(N,{variant:"secondary",onClick:t,children:"Close"})})]})},Ze=()=>{const[s,a]=i.useState(""),[t,h]=i.useState(""),[m,l]=i.useState(""),[n,o]=i.useState(""),{showAddLayerWindow:c,openAddLayerWindow:r}=R(),{map:d,addLayer:u}=I(),w=async f=>{f.preventDefault(),l(""),o("");const S=s.toLowerCase();let O=!1;if(d&&(O=await de(S,d)),!s.trim()){l("Layer name is required");return}if(!t.trim()){o("Link is required");return}if(O){l("Layer name exist");return}s.trim()&&t.trim()&&(u({id:S,name:s,type:"geojson",url:t,enable:!0,opacity:1}),a(""),h(""))};return e.jsxs(C,{show:c,onHide:()=>r(!1),children:[e.jsx(C.Header,{closeButton:!0,children:e.jsx(C.Title,{children:"Add layer"})}),e.jsxs(x,{noValidate:!0,onSubmit:w,children:[e.jsxs(C.Body,{children:[e.jsx(G,{children:e.jsxs(x.Group,{controlId:"layerNameId",children:[e.jsx(x.Control,{type:"text",placeholder:"Enter layer name",value:s,onChange:f=>a(f.target.value),required:!0}),e.jsx(x.Text,{className:"text-danger",children:m})]})}),e.jsx("br",{}),e.jsx(G,{children:e.jsxs(x.Group,{controlId:"geoJSONUrlId",children:[e.jsx(x.Control,{type:"text",placeholder:"Enter geoJSON url",value:t,onChange:f=>h(f.target.value),required:!0}),e.jsx(x.Text,{className:"text-danger",children:n})]})})]}),e.jsxs(C.Footer,{children:[e.jsx(N,{variant:"secondary",onClick:()=>r(!1),children:"Close"}),e.jsx(N,{variant:"primary",type:"submit",children:"Add layer"})]})]})]})},ne=i.createContext(void 0),Ye=({children:s})=>{const[a,t]=i.useState(!1),[h,m]=i.useState(!1),[l,n]=i.useState(!1),[o,c]=i.useState({title:"",features:[]}),f={showPrintWindow:a,openPrintWindow:S=>{t(S)},showAddLayerWindow:h,openAddLayerWindow:S=>{m(S)},showMoreDetailsWindow:l,openMoreDetailsWindow:(S,O)=>{c({title:S,features:O}),n(!0)},closeMoreDetailsWindow:()=>{n(!1)},moreDetailsWindowContent:o};return e.jsxs(ne.Provider,{value:f,children:[s,e.jsx(Xe,{}),e.jsx(Ze,{})]})},R=()=>{const s=i.useContext(ne);if(!s)throw new Error("useToolContext must be used within a ToolProvider");return s},$e=({id:s})=>{var c,r,d;const{toggleMinimap:a}=I(),{showPrintWindow:t,openPrintWindow:h,openAddLayerWindow:m}=R(),{map:l}=I(),n=(u,w)=>{switch(u){case je:l&&U(l,z);break;case V:a();break;case me:h(!t);break;case ye:m(!0);break;case pe:l&&w?xe(l,w):l&&(P(l,"measurmentLayer"),U(l,z));break;case ue:he();break}},o=(u,w)=>{for(const f of w){if(f.id===u)return f.icon;if(f.options){const S=o(u,f.options);if(S)return S}}return null};return(c=_(A,s))!=null&&c.options?e.jsxs(T,{className:"nav-link tool-button",children:[e.jsx(T.Toggle,{className:"card",title:(d=_(A,s))==null?void 0:d.title,children:o(s,A)}),e.jsx(T.Menu,{children:_(A,s).options.map(u=>e.jsxs(T.Item,{as:N,onClick:()=>n(s,u.type),children:[o(u.id,A)," ",u.title]},u.id))})]}):e.jsx("button",{className:"nav-link tool-button",title:(r=_(A,s))==null?void 0:r.title,onClick:()=>n(s),children:e.jsx(k,{className:"btn btn-primary",children:o(s,A)})})},Qe=()=>{const{tools:s}=q();return e.jsxs(H,{fixed:"top",className:"map-nav",style:{padding:".25rem .5rem"},children:[e.jsx(Se,{to:"/",className:"navbar-brand",title:"Go to home page",children:e.jsx(k,{style:{padding:".3rem"},children:e.jsx("img",{src:fe,alt:"Go to home page",style:{width:"1.5rem",height:"1.5rem"}})})}),e.jsx(H.Toggle,{"aria-controls":"basic-navbar-nav"}),e.jsx(H.Collapse,{id:"basic-navbar-nav",children:e.jsx(we,{className:"me-auto",children:s.map(a=>{if(a.enable)return e.jsx($e,{...a},a.id)})})})]})},es=()=>{const{layers:s,switchLayer:a,removeLayer:t,moveLayer:h,changeOpacityLayer:m,selectAll:l,updateAllLayers:n}=I(),{openMoreDetailsWindow:o}=R(),c=async(r,d)=>{document.body.style.cursor="progress";const u=await Ce(d);document.body.style.cursor="auto",o(r,u)};return e.jsxs(x,{className:"sidebar-layers",children:[e.jsx(x.Check,{id:"selectAll",type:"checkbox",label:"Select all",checked:l,onChange:()=>n(!l)}),s.map((r,d)=>e.jsxs("div",{className:"sidebar-layer",children:[e.jsx(x.Check,{id:r.id,type:"checkbox",label:r.name,checked:r.enable,onChange:()=>a(r.id)}),e.jsxs("div",{className:"sidebar-layer-actions",children:[e.jsxs("div",{className:"sidebar-layer-actions-arrows",children:[e.jsx(N,{className:"card",onClick:()=>h(r.id,-1),children:e.jsx(ge,{})}),e.jsx(N,{className:"card",onClick:()=>h(r.id,1),children:e.jsx(ve,{})})]}),e.jsxs(T,{className:"sidebar-layer-actions-dropdown",children:[e.jsx(T.Toggle,{className:"card",children:e.jsx(be,{})}),e.jsxs(T.Menu,{children:[e.jsxs(T.Item,{as:N,onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{children:[e.jsx(Ee,{}),"Opacity: "," "+r.opacity]}),e.jsx(x.Range,{value:r.opacity,min:0,max:1,step:.1,onTouchMove:u=>u.stopPropagation(),onChange:u=>m(r.id,parseFloat(u.target.value))})]}),e.jsxs(T.Item,{as:N,onClick:()=>{r.url&&c(r.name,r.url)},children:[e.jsx(Le,{})," Details"]}),e.jsxs(T.Item,{as:N,onClick:()=>t(r.id),children:[e.jsx(Te,{})," Remove"]})]})]})]})]},d))]})},ss=()=>{const{baseLayers:s,updateBaseLayers:a}=I();return e.jsx(x,{className:"sidebar-base-layers",children:s.map((t,h)=>e.jsxs(k,{onClick:()=>a(t.id),className:"sidebar-base-layers-row",border:t.enable?"primary":"secondary",children:[e.jsx("img",{src:`images/${t.image}`}),e.jsx(x.Check,{id:t.id,name:"baselayers",type:"radio",label:t.name,checked:t.enable,onChange:()=>{}})]},h))})},ts=({isOpen:s,toggleSidebar:a})=>e.jsxs(k,{className:`map-sidebar ${s?"open":""}`,children:[e.jsx("button",{className:"card",onClick:a,children:s?e.jsx(Ne,{}):e.jsx(Me,{})}),e.jsx("div",{className:"map-sidebar-content",children:e.jsxs(Oe,{defaultActiveKey:"layers",id:"map-sidebar",className:"mb-3",fill:!0,children:[e.jsx($,{eventKey:"layers",title:"Layers",children:e.jsx(es,{})}),e.jsx($,{eventKey:"baseLayers",title:"Base Layers",children:e.jsx(ss,{})})]})})]}),as="SET_CENTER",ns="SET_WIDTH",rs="SET_HEIGHT",os="SET_ORIENTATION",is="SET_FORMAT",cs="SET_PAGE_SIZE",ls="SET_RESOLUTION",ds="SET_SCALE",re={center:null,width:null,height:null,orientation:null,format:null,pageSize:"a4-landscape",resolution:"200",scale:"100"},us=(s=re,a)=>{switch(a.type){case as:return{...s,center:a.payload};case ns:return{...s,width:a.payload};case rs:return{...s,height:a.payload};case os:return{...s,orientation:a.payload};case is:return{...s,format:a.payload};case cs:return{...s,pageSize:a.payload};case ls:return{...s,resolution:a.payload};case ds:return{...s,scale:a.payload};default:return s}},hs=()=>{const{map:s}=I(),{showPrintWindow:a,openPrintWindow:t}=R(),[h,m]=i.useState(null),[l,n]=i.useReducer(us,re),{center:o,width:c,height:r,orientation:d,format:u,pageSize:w,resolution:f,scale:S}=l,O=y=>{y.preventDefault(),s&&c&&r&&h&&(Ge({map:s,width:c,height:r,overviewExtent:h,scale:S,resolution:f,orientation:d}),t(!a))},J=()=>{const[y,b]=Ve[u];let L,E;d==="portrait"?(L=b,E=y):(L=y,E=b),n({type:"SET_WIDTH",payload:L}),n({type:"SET_HEIGHT",payload:E})};i.useEffect(()=>{if(a){const y=s==null?void 0:s.getView().getCenter();y&&n({type:"SET_CENTER",payload:Q(y)})}},[a]),i.useEffect(()=>{n({type:"SET_ORIENTATION",payload:w.split("-")[1]}),n({type:"SET_FORMAT",payload:w.split("-")[0]})},[a,w]),i.useEffect(()=>{a&&u&&d&&J()},[a,u,d]),i.useEffect(()=>{if(s&&o&&w&&c&&r&&S){const[y,b]=o||[0,0],L=c/ee/+S,E=r/ee/+S,j=[y-L,b-E],g=[y+L,b-E],p=[y+L,b+E],v=[y-L,b+E],M=Ae(v,p,g,j),K=new Ie({features:[new _e(M)]}),B=ke(K,Be),X=new Re({features:new De(K.getFeatures())});P(s,"overviewLayer"),s==null||s.addLayer(B),s==null||s.addInteraction(X),m(M==null?void 0:M.getExtent()),X.on("translateend",oe=>{const F=oe.features.item(0).getGeometry(),Z=F==null?void 0:F.getExtent();m(Z),n({type:"SET_CENTER",payload:Q(We(Z))})}),B.set("id","overviewLayer"),B.setZIndex(1002)}s&&!a&&P(s,"overviewLayer")},[s,a,o,c,r,S]);const D=y=>y.map(b=>e.jsx("option",{value:b.value,children:b.label},b.value));return e.jsxs(k,{className:`map-print ${a?"open":""}`,children:[e.jsx("button",{className:"card",onClick:()=>{t(!a)},children:e.jsx(Pe,{})}),e.jsx("div",{className:"map-print-content",children:e.jsxs(x,{noValidate:!0,onSubmit:O,children:[e.jsxs(G,{children:[e.jsxs(x.Group,{as:W,controlId:"pageSizeId",children:[e.jsx(x.Label,{children:"Page size"}),e.jsx(x.Select,{size:"sm",name:"pageSize",value:w,onChange:y=>{n({type:"SET_PAGE_SIZE",payload:y.target.value})},required:!0,children:D(Fe)})]}),e.jsxs(x.Group,{as:W,controlId:"resolutionId",children:[e.jsx(x.Label,{children:"Resolution"}),e.jsx(x.Select,{size:"sm",name:"resolution",value:f,onChange:y=>{n({type:"SET_RESOLUTION",payload:y.target.value})},required:!0,children:D(He)})]})]}),e.jsx("br",{}),e.jsxs(G,{children:[e.jsxs(x.Group,{as:W,xs:8,controlId:"scaleId",children:[e.jsx(x.Label,{children:"Scale"}),e.jsx(x.Select,{size:"sm",name:"scale",value:S,onChange:y=>{n({type:"SET_SCALE",payload:y.target.value})},required:!0,children:D(Ue)})]}),e.jsx(x.Group,{as:W,xs:4,style:{marginTop:"auto"},children:e.jsx(N,{size:"sm",type:"submit",variant:"primary",children:"Export PDF"})})]})]})})]})},ps=()=>{const{minimapVisibility:s,tools:a}=q(),{map:t,initMap:h,isMinimap:m,layers:l,baseLayers:n}=I(),[o,c]=i.useState(null);return i.useEffect(()=>{h(),c(ze())},[]),i.useEffect(()=>{var r;(r=_(a,V))!=null&&r.enable&&s?t==null||t.addControl(o):t==null||t.removeControl(o)},[t,s,a]),i.useEffect(()=>{var d;const r=!(t!=null&&t.getControls().getArray().includes(o));(d=_(a,V))!=null&&d.enable&&m&&r?t==null||t.addControl(o):t==null||t.removeControl(o)},[m]),i.useEffect(()=>{if(t){navigator.geolocation.getCurrentPosition(d=>{const{longitude:u,latitude:w}=d.coords,f=qe([u,w]);t.getView().setCenter(f)},d=>{console.error("Error getting geolocation:",d)},{enableHighAccuracy:!0}),se(t,l),te(t,n);const r=d=>{t&&d.key==="Escape"&&U(t,z)};return window.addEventListener("keydown",r),()=>{window.removeEventListener("keydown",r)}}},[t]),i.useEffect(()=>{t&&se(t,l)},[l]),i.useEffect(()=>{t&&te(t,n)},[n]),e.jsx("main",{className:"map-view",id:"map-view"})},ms=()=>{const s=i.useRef(0),a=i.useRef(0),[t,h]=i.useState(!1),m=c=>{s.current=c.touches[0].clientX},l=c=>{a.current=c.touches[0].clientX},n=()=>{const c=s.current-a.current;Je()&&a.current&&c>60&&(h(!1),a.current=0)},o=()=>{h(!t)};return e.jsx(Ke,{children:e.jsxs(Ye,{children:[e.jsx(Qe,{}),e.jsx("div",{onTouchStart:m,onTouchMove:l,onTouchEnd:n,children:e.jsx(ts,{isOpen:t,toggleSidebar:o})}),e.jsx(hs,{}),e.jsx(ps,{})]})})};export{ms as default};
